---
title: "Taller ley de Benford"
output:
  html_document:
    toc: yes
  pdf_document:
    toc: yes
header-includes: \renewcommand{\contentsname}{Contenidos}
citecolor: blue
toccolor: blue
urlcolor: blue 
---



# La distribución de probabilidad de Benford

La [ley de Benford](https://en.wikipedia.org/wiki/Benford%27s_law) es  una 
distribución discreta que siguen las frecuencias de los primero dígitos 
significativos (de 1 a 9) de algunas series de datos que os pueden resultar 
sorprendentes  como los precios, los valores  de la contabilidad de una empresa,
algunas tablas  mediciones científicas o resultados de funciones 
trigonométricas.


Sea una v.a. X con dominio $D_X=\left\{1,2,3,4,5,6,7,8,9\right\}$ diremos que 
sigue una ley de Benford  si 

$$P(X=x)=\log_{10} \left(1+\frac{1}{x}\right)=\log_{10}(1+x)-\log_{10} (x)
\mbox{ para } x\in \left\{1,2,3,4,5,6,7,8,9\right\}.$$

Concretamente la función de  probabilidad de la ley Benford es 
(se muestran 4 decimales):


```{r,echo=FALSE,results='asis'}
probs_Benford=log10(1+1/c(1:9))
MM=rbind(c(1:9),probs_Benford)
df=data.frame(rbind(probs_Benford))
cumprobs_Benford=cumsum(probs_Benford)
colnames(df)=paste("Díg.",c(1:9),sep =" ")
knitr::kable(df,format ='markdown',digits = 4)
```

Su función de probabilidad y de distribución son

$$P_X(x)=P(X=x)=\left\{
\begin{array}{ll}
`r round(probs_Benford[1],4)` & \mbox{ si } x=1 \\
`r round(probs_Benford[2],4)` & \mbox{ si } x=2 \\
`r round(probs_Benford[3],4)` & \mbox{ si } x=3\\
`r round(probs_Benford[4],4)` & \mbox{ si } x=4\\
`r round(probs_Benford[5],4)` & \mbox{ si } x=5\\
`r round(probs_Benford[6],4)` & \mbox{ si } x=6\\
`r round(probs_Benford[7],4)` & \mbox{ si } x=7\\
`r round(probs_Benford[8],4)` & \mbox{ si } x=8\\
`r round(probs_Benford[9],4)` & \mbox{ si } x=9\\
 0  & \mbox{  en otro caso.} 
\end{array}\right.
$$

$$F_X(x)=P(X\leq x)=\left\{
\begin{array}{ll}
0 & \mbox{ si } x<1 \\ 
`r round(cumprobs_Benford[1],4)` & \mbox{ si } 1\leq x <2 \\
`r round(cumprobs_Benford[2],4)` & \mbox{ si } 2\leq x <2 \\
`r round(cumprobs_Benford[3],4)` & \mbox{ si } 3\leq x <4 \\
`r round(cumprobs_Benford[4],4)` & \mbox{ si } 4\leq x <2 \\
`r round(cumprobs_Benford[5],4)` & \mbox{ si } 5\leq x <5 \\
`r round(cumprobs_Benford[6],4)` & \mbox{ si } 6\leq x <7 \\
`r round(cumprobs_Benford[7],4)` & \mbox{ si } 7\leq x <8 \\
`r round(cumprobs_Benford[8],4)` & \mbox{ si } 8\leq x <9 \\
 1  & \mbox{ si } 9\leq x
\end{array}\right.
$$

El valor esperado  y la varianza son 


$$E(X)=\sum_{x=1}^{9} x\cdot \log_{10} \left(1+\frac{1}{x}\right)=
`r round(sum(1:9*probs_Benford),4)`.
$$

$$Var(X)=\sum_{x=1}^{9} x^2\cdot \log_{10} \left(1+\frac{1}{x}\right)-E(X)^2=
`r round(sum((1:9)^2*probs_Benford),4)`-E(X)^2=
`r round(sum((1:9)^2*probs_Benford)-sum(1:9*probs_Benford)^2,4)`.
$$



## El primer dígito de las potencias de 2 y de 5

Por ejemplo el primer dígito de las potencias de 2  y las de 5 sigue una ley Benford



## El primer dígito de las potencias de 2 

Calculemos las potencia enteras de 2 de  1 a 200 ( la potencia máxima para  R es $2^{1023}$, $2^{1024}$  da 
`Inf`.)


```{r}
# Calculemos las potencia de 2 de 1 a 200
# podéis calcularlas hasta 2023.
potencias_muestra2=2^c(1:200)
# Las transformamos a character 
d1=as.character(potencias_muestra2)
# Extraemos el primer dígito
d1=substr(d1,1,1)
# Calculamos las frecuencias absolutas  de cada dígito
frec_absolutas_observadas=table(d1)
frec_absolutas_observadas
# Calculamos las teóricas según la ley de Benford
prob_teoricas=log10(1+1/c(1:9))
prob_teoricas
prop_observadas= prop.table(frec_absolutas_observadas)
prop_observadas
```




Guardemos todo en un `data frame`

```{r}
dig_pot_2= data.frame(dig=1:9,
                      prob_teoricas=prob_teoricas,
                      prob_observadas=as.numeric(prop_observadas)
                      )
dig_pot_2$dif=dig_pot_2$prob_teoricas-dig_pot_2$prob_observadas
knitr::kable(dig_pot_2,digits = 4)
```



```{r}
par(mfrow=c(1,2))
bar1=dig_pot_2[,2]
names(bar1)=1:9
barplot(bar1,
        ylim=c(0,0.35),
        col=c("red"),
        width =0.2,
        main="Probabilidades obervadas",
        cex.names=0.7)
bar2=dig_pot_2[,3]
names(bar2)=1:9
barplot(bar2,
        ylim=c(0,0.35),
        col=c("blue"),
        width=0.2,
        main="Probabilidades teóricas",
        cex.names=0.7)
par(mfrow=c(1,1))
```

## El primer dígito de las pontencias de 5

Para las potencias de 5 también podemos hacer lo mismo

```{r}
# Calculemos las potencia de 5 de 1 a 200
potencias_muestra5=5^c(1:200)
# Las transformamos a character 
d1=as.character(potencias_muestra5)
# Extraemos el primer dígito
d1=substr(d1,1,1)
# Calculamos las frecuencias absolutas  de cada dígito
frec_absolutas_observadas=table(d1)
frec_absolutas_observadas
# Calculamos las teóricas según la ley de Benford
prob_teoricas=log10(1+1/c(1:9))
prob_teoricas
prop_observadas= prop.table(frec_absolutas_observadas)
```




Guardemos todo en un `data frame`

```{r}
dig_pot_5= data.frame(dig=1:9,
                      prob_teoricas=prob_teoricas,
                      prob_observadas=as.numeric(prop_observadas)
                      )
knitr::kable(dig_pot_5,digits = 4)
```


```{r}
x=round(10*runif(1000,0.1,0.9),0)
table(x)

```



